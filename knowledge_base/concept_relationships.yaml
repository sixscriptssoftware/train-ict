# =============================================================================
# ICT CONCEPT RELATIONSHIPS
# =============================================================================
# This is the "brain wiring" - how ICT concepts connect, depend on each other,
# and combine to create high-probability setups.
#
# Three types of relationships:
#   1. CAUSAL: X must happen before Y
#   2. CONFLUENCE: X + Y together = stronger signal  
#   3. INVALIDATION: X cancels out Y
# =============================================================================

version: "1.0"
last_updated: "2026-01-16"

# =============================================================================
# CAUSAL CHAINS - The Order Things MUST Happen
# =============================================================================
# ICT is sequential. You can't skip steps.

causal_chains:
  
  # The Master Sequence for any reversal trade
  reversal_sequence:
    description: "The required order for reversal entries"
    steps:
      1: {concept: "liquidity_sweep", signal: "Liquidity taken (BSL/SSL)"}
      2: {concept: "displacement", signal: "Strong momentum candle away from sweep"}
      3: {concept: "fvg_or_ob", signal: "Imbalance or order block forms"}
      4: {concept: "retracement", signal: "Price returns to FVG/OB"}
      5: {concept: "entry", signal: "Enter in zone with SL beyond sweep"}
    failure_at_step:
      1: "No liquidity = no fuel for move, skip this setup"
      2: "No displacement = weak hands, likely to fail"
      3: "No FVG/OB = no clear entry zone"
      4: "No retracement = chasing, bad R:R"

  # Power of 3 (AMD) - Session-based
  power_of_3:
    description: "Accumulation → Manipulation → Distribution within a session"
    steps:
      1: {phase: "accumulation", time: "Asian session / early London", action: "Range forms, liquidity builds"}
      2: {phase: "manipulation", time: "London open / NY open", action: "False breakout, sweeps liquidity"}
      3: {phase: "distribution", time: "Mid-session", action: "True move in opposite direction"}
    key_insight: "The manipulation IS the entry signal - it sweeps liquidity"
    
  # HTF to LTF Flow
  htf_to_ltf:
    description: "Always align with higher timeframe bias"
    steps:
      1: {action: "Determine HTF bias", timeframes: ["Daily", "4H"]}
      2: {action: "Identify HTF POI", concepts: ["fvg", "order_block", "liquidity"]}
      3: {action: "Wait for price at HTF POI", patience: "critical"}
      4: {action: "Drop to LTF for entry", timeframes: ["15m", "5m", "1m"]}
      5: {action: "Find LTF confirmation", concepts: ["displacement", "bos", "fvg"]}
    failure_mode: "Trading LTF without HTF context = gambling"

# =============================================================================
# CONCEPT DEPENDENCIES - What Each Concept Needs
# =============================================================================

concept_requirements:

  fair_value_gap:
    requires:
      - {concept: "displacement", why: "FVG without displacement is just a gap that will fill"}
    enhanced_by:
      - {concept: "htf_poi", bonus: 1.5, why: "FVG at HTF level = institutional interest"}
      - {concept: "ote_zone", bonus: 1.0, why: "FVG in OTE = optimal entry"}
      - {concept: "order_block", bonus: 1.5, why: "FVG inside OB = Unicorn setup"}
    targets:
      - {concept: "opposite_liquidity", why: "Your TP should be where liquidity sits"}
    invalidated_by:
      - {condition: "gap_fills_before_entry", why: "Imbalance resolved, no trade"}
      - {condition: "no_displacement", why: "Low probability fill"}
    entry_rules:
      - "Enter on first tap of FVG"
      - "SL below/above FVG origin"
      - "Don't enter if 50% of FVG already filled"

  order_block:
    requires:
      - {concept: "liquidity_sweep", why: "OB forms AFTER liquidity is taken"}
      - {concept: "displacement", why: "OB is the last candle before displacement"}
    enhanced_by:
      - {concept: "fvg_inside", bonus: 2.0, why: "This is the Unicorn - highest probability"}
      - {concept: "htf_poi", bonus: 1.5}
      - {concept: "ote_zone", bonus: 1.0}
    identification:
      bullish: "Last red candle before bullish displacement"
      bearish: "Last green candle before bearish displacement"
    invalidated_by:
      - {condition: "body_broken", why: "If price closes through OB body, it's dead"}
      - {condition: "no_reaction_on_first_touch", why: "Institutions didn't defend it"}

  liquidity:
    types:
      buy_side: ["equal_highs", "swing_highs", "trendline_liquidity", "asian_high"]
      sell_side: ["equal_lows", "swing_lows", "trendline_liquidity", "asian_low"]
    behavior:
      - "Price is DRAWN to liquidity"
      - "Liquidity sweep = fuel for the move"
      - "Double/triple taps = liquidity building (will be swept)"
    sequence_after_sweep:
      1: "Sweep happens"
      2: "Look for displacement in opposite direction"
      3: "That displacement confirms the reversal"
    key_insight: "Don't trade UNTIL liquidity is swept"

  displacement:
    definition: "Large-bodied candle with conviction (usually 2x+ average range)"
    indicates: "Institutional order flow / smart money commitment"
    creates:
      - {concept: "fvg", likelihood: "high"}
      - {concept: "order_block", likelihood: "always"}
    required_for:
      - "Valid FVG"
      - "Valid Order Block"
      - "Confirmation of liquidity sweep"
    without_displacement: "Setup is weak - smart money not committed"

  optimal_trade_entry:
    zone: "62% to 79% retracement"
    sweet_spot: "70.5% (0.705 fib)"
    enhanced_by:
      - {concept: "fvg_in_zone", why: "Price likely to react at both"}
      - {concept: "order_block_in_zone", why: "Confluence of levels"}
    usage: "After displacement, wait for retracement to OTE before entry"

  market_structure:
    types:
      bos: 
        meaning: "Break of Structure - trend continuation"
        action: "Look for pullback entry in trend direction"
      choch:
        meaning: "Change of Character - potential reversal"
        action: "First warning sign, not entry signal alone"
      mss:
        meaning: "Market Structure Shift - confirmed reversal"
        action: "After liquidity sweep + MSS = entry setup"
    sequence: "Liquidity sweep → CHoCH → MSS → Entry"
    
  smt_divergence:
    definition: "Correlated pair makes new high/low, other doesn't"
    pairs:
      - ["EUR_USD", "GBP_USD"]
      - ["ES", "NQ"]
      - ["DXY", "EUR_USD"]  # Inverse
    signal: "The pair that DOESN'T make the new extreme shows the true direction"
    weight: 1.5
    key_insight: "SMT at liquidity sweep = high probability reversal"

# =============================================================================
# MODEL BLUEPRINTS - Complete Setup Requirements
# =============================================================================

models:

  silver_bullet:
    time_windows:
      - {start: "10:00", end: "11:00", timezone: "America/New_York", name: "AM Silver Bullet"}
      - {start: "14:00", end: "15:00", timezone: "America/New_York", name: "PM Silver Bullet"}
    required:
      - "FVG forms within time window"
      - "FVG is in direction of HTF bias"
      - "Liquidity was swept before FVG"
    entry: "First tap of FVG"
    target: "Opposite liquidity or 15-20 pips"
    avoid_when:
      - "No clear HTF bias"
      - "Major news in window"
      - "FVG already 50%+ filled"
    historical_stats_placeholder:
      win_rate: 0.0
      avg_rr: 0.0
      total_trades: 0

  ict_2022_model:
    description: "Full AMD cycle trade"
    required:
      - "Clear accumulation range (Asian/early London)"
      - "Manipulation sweep of range liquidity"
      - "Displacement + FVG after sweep"
      - "Entry in FVG"
    time_context: "Best at session opens (London, NY)"
    target: "Opposite side of accumulation range"
    
  unicorn:
    description: "Order Block with FVG inside - highest probability"
    required:
      - "Valid Order Block (post liquidity sweep)"
      - "FVG contained within the OB"
      - "HTF bias alignment"
    rarity: "Uncommon - maybe 2-3 per week"
    probability: "Highest of all setups"
    entry: "Inside the FVG portion of the OB"
    
  turtle_soup:
    description: "Liquidity sweep immediate reversal"
    required:
      - "Clear liquidity pool (equal highs/lows)"
      - "Sweep of that liquidity"
      - "Immediate reversal candle"
    entry: "On the reversal candle, SL beyond the sweep"
    target: "Opposite liquidity"
    key: "Speed - the faster the reversal, the better"

  judas_swing:
    description: "False move at session open"
    time: "First 30-60 min of London or NY"
    required:
      - "Initial move against the day's intended direction"
      - "Sweep of overnight/Asian liquidity"
      - "Reversal with displacement"
    insight: "The Judas Swing IS the manipulation phase of AMD"

# =============================================================================
# CONFLUENCE WEIGHTS - Scoring System
# =============================================================================

confluence_weights:
  # Critical (must have at least one)
  critical:
    liquidity_swept: 2.5
    htf_bias_aligned: 2.0
    displacement_confirmed: 2.0
    
  # High value
  high:
    in_fvg: 1.5
    at_order_block: 1.5
    smt_divergence: 1.5
    in_killzone: 1.5
    
  # Moderate value  
  moderate:
    at_ote_level: 1.0
    structure_break: 1.0
    targeting_liquidity: 1.0
    
  # Bonuses
  bonuses:
    unicorn_setup: 2.0  # OB + FVG together
    htf_poi_alignment: 1.5  # LTF entry at HTF level
    multi_timeframe_confluence: 1.5  # Same signal on multiple TFs
    
  # Penalties
  penalties:
    against_htf_bias: -2.0
    no_liquidity_sweep: -2.0
    no_displacement: -1.5
    outside_killzone: -1.0
    overextended: -1.0
    news_imminent: -1.5

  # Scoring thresholds
  thresholds:
    minimum_for_trade: 5.0
    good_setup: 7.0
    a_plus_setup: 9.0

# =============================================================================
# ANTI-PATTERNS - What NOT to Do
# =============================================================================

anti_patterns:

  fvg_without_displacement:
    description: "Entering FVG that formed without strong momentum"
    why_fails: "No institutional commitment, gap likely to fill through you"
    historical_winrate: 0.25
    fix: "Wait for displacement candle before considering FVG valid"

  entry_before_liquidity_sweep:
    description: "Entering at support/resistance before liquidity taken"
    why_fails: "You become the liquidity for smart money"
    symptom: "Stopped out right before the move"
    fix: "Wait for sweep, THEN enter"

  chasing_after_displacement:
    description: "Entering immediately after big move instead of waiting for pullback"
    why_fails: "Bad R:R, often enter at worst price"
    fix: "Wait for retracement to FVG/OB/OTE"

  trading_against_htf:
    description: "Taking LTF signals against higher timeframe bias"
    why_fails: "Swimming upstream - occasional wins, consistent losses"
    fix: "Only take LTF signals in direction of HTF bias"

  multiple_stacked_fvgs:
    description: "3+ FVGs stacked in same direction"
    why_fails: "Price tends to fill imbalances, will likely retrace through all"
    fix: "Wait for consolidation or skip the setup"

  equal_highs_lows_untapped:
    description: "Taking a trade when obvious liquidity hasn't been swept"
    why_fails: "Price will hunt that liquidity first"
    fix: "Wait for the sweep or target the liquidity as your TP"

  revenge_trading:
    description: "Entering immediately after a loss"
    why_fails: "Emotional state leads to poor decisions"
    fix: "Mandatory 30-min break after any loss"

  overtrading_sessions:
    description: "More than 2-3 trades per session"
    why_fails: "Quality setups are rare, forcing trades = losses"
    fix: "Max 2 trades per session, then walk away"

# =============================================================================
# TIME-BASED RULES
# =============================================================================

time_rules:
  
  killzones:
    asian:
      time: "19:00-00:00 ET"
      behavior: "Accumulation, range-bound"
      trade_style: "Generally avoid, or fade extremes"
      liquidity_builds: ["asian_high", "asian_low"]
      
    london:
      time: "02:00-05:00 ET"
      behavior: "First real move of the day"
      trade_style: "Look for sweep of Asian range"
      best_setups: ["judas_swing", "ict_2022"]
      
    ny_am:
      time: "08:30-11:00 ET"
      behavior: "Highest volume, biggest moves"
      trade_style: "Primary trading session"
      best_setups: ["silver_bullet", "turtle_soup"]
      contains: ["10am_silver_bullet"]
      
    ny_pm:
      time: "13:30-16:00 ET"
      behavior: "Second push, often reversal of AM"
      trade_style: "Continuation or reversal"
      best_setups: ["silver_bullet", "pm_session_reversal"]
      contains: ["3pm_silver_bullet"]

  avoid_times:
    - {time: "12:00-13:30 ET", reason: "NY lunch - choppy, no direction"}
    - {time: "major_news", reason: "30 min before/after high impact news"}
    - {time: "17:00 ET", reason: "Market close - spreads widen"}
    - {time: "sunday_open", reason: "Gaps and low liquidity"}
    - {time: "friday_afternoon", reason: "Position squaring, unpredictable"}

  macro_times:
    description: "ICT macro times - micro session opens"
    times:
      - "09:30 ET - NYSE open"
      - "09:50 ET"
      - "10:10 ET"
      - "10:50 ET"
      - "11:10 ET"
      - "13:10 ET"
      - "13:50 ET"
      - "14:10 ET"
      - "14:50 ET"
      - "15:10 ET"
      - "15:50 ET"
    usage: "Look for displacement/FVG at these exact times"

# =============================================================================
# PAIR-SPECIFIC RULES
# =============================================================================

pair_rules:
  
  EUR_USD:
    correlations: ["GBP_USD_positive", "DXY_inverse"]
    best_sessions: ["london", "ny_am"]
    characteristics: "Most liquid, cleanest price action"
    smt_partner: "GBP_USD"
    typical_daily_range: "60-80 pips"
    
  GBP_USD:
    correlations: ["EUR_USD_positive", "DXY_inverse"]
    best_sessions: ["london", "ny_am"]  
    characteristics: "More volatile than EUR, wider swings"
    smt_partner: "EUR_USD"
    typical_daily_range: "80-120 pips"
    warning: "Can be whippy around UK news"
    
  USD_JPY:
    correlations: ["US_yields_positive"]
    best_sessions: ["asian", "ny_am"]
    characteristics: "Respects round numbers, big moves"
    pip_size: 0.01
    warning: "BOJ intervention risk at extremes"

  XAU_USD:
    characteristics: "Volatile, big swings, respects HTF levels"
    best_sessions: ["ny_am"]
    warning: "Wide spreads, needs bigger stops"
    typical_daily_range: "200-400 pips"

# =============================================================================
# LEARNING FEEDBACK LOOP
# =============================================================================
# This section gets auto-updated based on trade outcomes

trade_correlations:
  
  # Format: confluence_combo -> stats
  # Updated automatically after each trade
  
  winning_combinations:
    # Populated by learning system
    example:
      confluences: ["liquidity_swept", "displacement", "fvg", "htf_aligned"]
      stats:
        trades: 0
        wins: 0
        win_rate: 0.0
        avg_rr: 0.0
        
  losing_combinations:
    # Populated by learning system  
    example:
      confluences: ["fvg", "no_displacement"]
      stats:
        trades: 0
        losses: 0
        loss_rate: 0.0
        common_reason: ""

  model_performance:
    # Per-model tracking
    silver_bullet: {trades: 0, wins: 0, win_rate: 0.0}
    ict_2022: {trades: 0, wins: 0, win_rate: 0.0}
    unicorn: {trades: 0, wins: 0, win_rate: 0.0}
    turtle_soup: {trades: 0, wins: 0, win_rate: 0.0}

# =============================================================================
# VALIDATION RULES FOR PRE-TRADE CHECKLIST
# =============================================================================

pre_trade_validation:
  
  must_have_one:
    - "liquidity_swept"
    - "at_htf_poi"  # Alternative: already at a key level
    
  must_have_all:
    - "htf_bias_determined"
    - "entry_zone_identified"  # FVG, OB, or OTE
    - "stop_loss_defined"
    - "target_defined"
    
  should_have:
    - "displacement_confirmed"
    - "in_killzone"
    - "risk_under_1_percent"
    
  red_flags:  # Any of these = no trade
    - "against_htf_bias"
    - "news_in_30_min"
    - "already_2_trades_today"
    - "revenge_trading"
    - "outside_all_killzones"
    - "no_clear_invalidation"

# =============================================================================
# QUERY HELPERS
# =============================================================================
# Example queries the system should answer:

example_queries:
  - query: "What do I need for a valid Silver Bullet?"
    answer_from: ["models.silver_bullet.required", "models.silver_bullet.time_windows"]
    
  - query: "Why did my FVG trade fail?"
    answer_from: ["anti_patterns.fvg_without_displacement", "concept_requirements.fair_value_gap.invalidated_by"]
    
  - query: "Is this a good time to trade?"
    answer_from: ["time_rules.killzones", "time_rules.avoid_times"]
    
  - query: "What's my best performing setup?"
    answer_from: ["trade_correlations.winning_combinations", "trade_correlations.model_performance"]
